<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VtM V5 Dice Roller</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111;
      color: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      background: #1b1b1b;
      border-radius: 24px;
      padding: 20px 24px 24px;
      max-width: 640px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    }

    h1 {
      margin-top: 0;
      margin-bottom: 4px;
      font-size: 1.4rem;
      letter-spacing: 0.03em;
      text-align: center;
    }

    .subtitle {
      margin: 0 0 16px;
      font-size: 0.85rem;
      text-align: center;
      color: #aaa;
    }

    .field-row {
      display: flex;
      gap: 12px;
      margin-bottom: 10px;
    }

    .field {
      flex: 1;
      display: flex;
      flex-direction: column;
      font-size: 0.8rem;
    }

    label {
      margin-bottom: 4px;
      color: #ccc;
    }

    input[type="number"] {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #101010;
      color: #eee;
      font-size: 0.95rem;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #c2185b;
      box-shadow: 0 0 0 1px rgba(194, 24, 91, 0.6);
    }

    #rollButton {
      width: 100%;
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      background: linear-gradient(135deg, #c2185b, #6a1b9a);
      color: #fff;
      transition: transform 0.05s ease, box-shadow 0.05s ease, filter 0.1s ease;
    }

    #rollButton:hover {
      filter: brightness(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    }

    #rollButton:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }

    .results {
      margin-top: 16px;
      font-size: 0.9rem;
    }

    .summary-line {
      margin-bottom: 6px;
    }

    .result-tag {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      margin-left: 4px;
    }

    .tag-success {
      background: rgba(76, 175, 80, 0.18);
      border: 1px solid #4caf50;
      color: #c8e6c9;
    }

    .tag-failure {
      background: rgba(244, 67, 54, 0.18);
      border: 1px solid #f44336;
      color: #ffcdd2;
    }

    .tag-critical {
      background: rgba(255, 235, 59, 0.15);
      border: 1px solid #ffeb3b;
      color: #fff9c4;
    }

    .tag-messy {
      background: rgba(244, 67, 54, 0.25);
      border: 1px solid #ff5252;
      color: #ffebee;
    }

    .dice-section {
      margin-top: 10px;
    }

    .dice-header {
      font-size: 0.8rem;
      color: #aaa;
      margin-bottom: 6px;
    }

    .dice-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .die {
      width: 28px;
      height: 28px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85rem;
      border: 2px solid #555;
      background: #181818;
    }

    .die.normal {
      border-color: #888;
    }

    .die.hunger {
      border-color: #f44336;
      color: #ffcdd2;
    }

    .die.success {
      box-shadow: 0 0 0 2px rgba(62, 191, 66, 0.6);
    }

    .die.crit {
      box-shadow: 0 0 1px 2px rgba(255, 255, 255, 0.9);
      font-size: 0.95rem;
    }

    .die.beast {
      background: #3b0000;
      box-shadow: 0 0 1px 2px rgba(244, 67, 54, 0.8);
    }

    .hint {
      margin-top: 10px;
      font-size: 0.75rem;
      color: #777;
    }

    .error {
      color: #ff8a80;
      font-size: 0.8rem;
      margin-top: 6px;
    }

    @media (max-width: 600px) {
      body {
        align-items: flex-start;
        /* top-align instead of vertical center */
        padding: 12px;
        /* breathing room from screen edges */
      }

      .container {
        max-width: 100%;
        /* use full screen width */
        margin-top: 12px;
        border-radius: 0.75rem;
        /* optional: slightly softer corners */
        box-shadow: none;
        /* optional: less “heavy” on mobile */
      }

      h1 {
        font-size: 1.2rem;
        /* gently shrink big text */
      }

      .subtitle {
        font-size: 0.8rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>VtM V5 Dice Roller</h1>
    <p class="subtitle">Personal browser-based roller — no servers, just the Beast.</p>

    <div class="field-row">
      <div class="field">
        <label for="poolInput">Dice Pool</label>
        <input id="poolInput" type="number" min="1" value="7">
      </div>
      <div class="field">
        <label for="hungerInput">Hunger (0-5)</label>
        <input id="hungerInput" type="number" min="0" max="5" value="3">
      </div>
      <div class="field">
        <label for="difficultyInput">Difficulty (optional)</label>
        <input id="difficultyInput" type="number" min="0" placeholder="e.g. 2">
      </div>
    </div>

    <button id="rollButton">Roll Dice</button>
    <div id="error" class="error"></div>

    <div class="results">
      <div id="summary" class="summary-line"></div>

      <div class="dice-section">
        <div class="dice-header">Normal Dice</div>
        <div id="normalDiceRow" class="dice-row"></div>
      </div>

      <div class="dice-section">
        <div class="dice-header">Hunger Dice</div>
        <div id="hungerDiceRow" class="dice-row"></div>
      </div>

      <div class="hint">
        6-10 = 1 success. Each pair of 10s adds +2 bonus successes (critical).
        Messy Critical = crit with at least one Hunger 10. Bestial Failure = failed roll with a Hunger 1.
      </div>
    </div>
  </div>

  <script>
    function rollDie() {
      return Math.floor(Math.random() * 10) + 1; // 1–10
    }

    function rollV5(pool, hunger, difficulty) {
      // Sanity checks
      if (pool <= 0 || !Number.isFinite(pool)) {
        throw new Error("Dice pool must be at least 1.");
      }

      if (!Number.isFinite(hunger) || hunger < 0) hunger = 0;
      if (hunger > 5) hunger = 5;
      if (hunger > pool) hunger = pool;

      const normalCount = pool - hunger;

      const normalDice = [];
      const hungerDice = [];

      for (let i = 0; i < normalCount; i++) {
        normalDice.push(rollDie());
      }
      for (let i = 0; i < hunger; i++) {
        hungerDice.push(rollDie());
      }

      let successes = 0;
      let totalTens = 0;
      let hungerTens = 0;
      let hungerOnes = 0;

      function scoreDie(value, isHunger) {
        if (value >= 6 && value <= 9) {
          successes += 1;
        } else if (value === 10) {
          successes += 1;
          totalTens += 1;
          if (isHunger) hungerTens += 1;
        }

        if (isHunger && value === 1) {
          hungerOnes += 1;
        }
      }

      normalDice.forEach(v => scoreDie(v, false));
      hungerDice.forEach(v => scoreDie(v, true));

      const critPairs = Math.floor(totalTens / 2);
      const critBonus = critPairs * 2;
      successes += critBonus;

      const isCrit = critPairs > 0;
      const isMessy = isCrit && hungerTens > 0;

      const hasDifficulty = Number.isFinite(difficulty) && difficulty > 0;
      const isFailure = hasDifficulty ? successes < difficulty : false;
      const isBestialFailure = isFailure && hungerOnes > 0;

      let resultType = "";
      if (hasDifficulty) {
        if (!isFailure) {
          if (isMessy) resultType = "messy-critical";
          else if (isCrit) resultType = "critical";
          else resultType = "success";
        } else {
          resultType = isBestialFailure ? "bestial-failure" : "failure";
        }
      } else {
        if (isMessy) resultType = "messy-critical";
        else if (isCrit) resultType = "critical";
      }

      return {
        pool,
        hunger,
        difficulty: hasDifficulty ? difficulty : null,
        normalDice,
        hungerDice,
        successes,
        critPairs,
        critBonus,
        isCrit,
        isMessy,
        isFailure,
        isBestialFailure,
        resultType
      };
    }

    function renderRoll(result) {
      const summaryEl = document.getElementById("summary");
      const normalRow = document.getElementById("normalDiceRow");
      const hungerRow = document.getElementById("hungerDiceRow");

      const {
        pool,
        hunger,
        difficulty,
        normalDice,
        hungerDice,
        successes,
        isCrit,
        isMessy,
        isFailure,
        isBestialFailure,
        resultType
      } = result;

      const hasDifficulty = difficulty !== null;

      // Summary text
      let text = `Rolled ${pool} dice (${pool - hunger} normal + ${hunger} Hunger) → <strong>${successes}</strong> successes`;
      if (difficulty !== null) {
        text += ` vs difficulty <strong>${difficulty}</strong>`;
      }

      let tagsHtml = "";
      if (!hasDifficulty) {
        // No difficulty: just label crit types, no generic "Success"
        if (resultType === "critical") {
          tagsHtml = `<span class="result-tag tag-critical">Critical</span>`;
        } else if (resultType === "messy-critical") {
          tagsHtml = `<span class="result-tag tag-messy">Messy Critical</span>`;
        }
      } else {
        // Difficulty present: full success/failure labelling
        switch (resultType) {
          case "success":
            tagsHtml = `<span class="result-tag tag-success">Success</span>`;
            break;
          case "critical":
            tagsHtml = `<span class="result-tag tag-success">Success</span>
                  <span class="result-tag tag-critical">Critical</span>`;
            break;
          case "messy-critical":
            tagsHtml = `<span class="result-tag tag-success">Success</span>
                  <span class="result-tag tag-messy">Messy Critical</span>`;
            break;
          case "failure":
            tagsHtml = `<span class="result-tag tag-failure">Failure</span>`;
            break;
          case "bestial-failure":
            tagsHtml = `<span class="result-tag tag-failure">Bestial Failure</span>`;
            break;
          default:
            break;
        }
      }

      summaryEl.innerHTML = text + (tagsHtml ? " " + tagsHtml : "");

      // Dice display
      const normalHtml = normalDice.map(v => {
        let cls = "die normal";
        if (v >= 6 && v <= 9) cls += " success";
        else if (v === 10) cls += " crit";
        return `<span class="${cls}">${v}</span>`;
      }).join("");

      const hungerHtml = hungerDice.map(v => {
        let cls = "die hunger";
        if (v === 1) cls += " beast";
        else if (v >= 6 && v <= 9) cls += " success";
        else if (v === 10) cls += " crit";
        return `<span class="${cls}">${v}</span>`;
      }).join("");

      normalRow.innerHTML = normalHtml;
      hungerRow.innerHTML = hungerHtml;
    }

    document.getElementById("rollButton").addEventListener("click", () => {
      const poolVal = parseInt(document.getElementById("poolInput").value, 10);
      const hungerVal = parseInt(document.getElementById("hungerInput").value, 10);
      const diffRaw = document.getElementById("difficultyInput").value.trim();
      const errorEl = document.getElementById("error");
      errorEl.textContent = "";

      const diffVal = diffRaw === "" ? NaN : parseInt(diffRaw, 10);

      try {
        const result = rollV5(poolVal, hungerVal, diffVal);
        // Update inputs with any clamped values (e.g., hunger > pool)
        document.getElementById("hungerInput").value = result.hunger;
        renderRoll(result);
      } catch (e) {
        errorEl.textContent = e.message;
      }
    });

    // Initial demo roll
    (function initialRoll() {
      const result = rollV5(7, 3, NaN);
      renderRoll(result);
    })();
  </script>
</body>

</html>
